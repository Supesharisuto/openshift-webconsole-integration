apiVersion: v1
kind: Template
metadata:
  name: "${{NAME}}"
  annotations:
    description: "An integration between OpenShift web console and Monitoring OpenShift application in Splunk"
    iconClass: "icon-nodejs"
    tags: "splunk,integration"
    openshift.io/provider-display-name: "Outcold Solutions"
    openshift.io/documentation-url: "https://github.com/outcoldsolutions/openshift-webconsole-integration",
    openshift.io/support-url: "https://www.outcoldsolutions.com",
objects:
- kind: Service
  apiVersion: v1
  metadata:
    name: "${{NAME}}"
  spec:
    ports:
      - name: web
        port: "3000"
        targetPort: "3000"
    selector:
      name: "${{NAME}}"
- kind: Route
  apiVersion: v1
  metadata:
    name: "${{NAME}}"
  spec:
    host: "${APPLICATION_DOMAIN}"
    to:
      kind: Service
      name: "${{NAME}}"
- kind: ImageStream
  apiVersion: v1
  metadata:
    name: "${{NAME}}"
- kind: BuildConfig
  apiVersion: v1
  metadata:
    name: "${{NAME}}"
    annotations:
      template.alpha.openshift.io/wait-for-ready: "true"
  spec:
    source:
      type: Git
      git:
        uri: "${{SOURCE_REPOSITORY_URL}}"
        ref: "${{SOURCE_REPOSITORY_REF}}"
    strategy:
      type: Source
      sourceStrategy:
        from:
          kind: ImageStreamTag
          namespace: "${{NAMESPACE}}"
          name: nodejs:8
    output:
      to:
        kind: ImageStreamTag
        name: "${{NAME}}:latest"
    triggers:
      - type: ImageChange
      - type: ConfigChange
- kind: DeploymentConfig
  apiVersion: v1
  metadata:
    name: "${{NAME}}"
    annotations:
      template.alpha.openshift.io/wait-for-ready: "true"
  spec:
    strategy:
      type: Rolling
    triggers:
      - type: ImageChange
        imageChangeParams:
          automatic: "true"
          containerNames:
          - "${{NAME}}"
          from:
            kind: ImageStreamTag
            name: "${{NAME}}:latest"
      - type: ConfigChange
    replicas: "${{REPLICA_COUNT}}"
    selector:
      name: "${{NAME}}"
    template:
      metadata:
        name: "${{NAME}}"
        labels:
          name: "${{NAME}}"
      spec:
        containers:
        - name: "${{NAME}}"
          image: " "
          ports:
            - containerPort: 8080
          resources:
            limits:
              memory: 32Mi
              cpu: 0.100
            requests:
              memory: 16Mi
              cpu: 0.010
parameters:
- name: NAME
  displayName: Name
  description: The name assigned to all of the frontend objects defined in this template
  required: "true"
  value: "webconsole-integration"
- name: NAMESPACE
  displayName: Namespace
  description: The OpenShift Namespace where the ImageStream resides
  required: "true"
  value: "webconsole-integration"
- name: SOURCE_REPOSITORY_URL
  displayName: Git Repository UR
  description: The URL of the repository with your application source code.
  required: true
  value: https://github.com/outcoldsolutions/openshift-webconsole-integration
- name: SOURCE_REPOSITORY_REF
  displayName: Git Reference
  description: Set this to a branch name, tag or other ref of your repository if you are not using the default branch.
- name: APPLICATION_DOMAIN
  displayName: Application Hostname
  description: The exposed hostname that will route to the Node.js service, if left blank a value will be defaulted.
  value: ""
- name: SPLUNK_WEB_URL
  description: Splunk URL (example: https://splunk:8000)
  required: true
  value: "https://localhost:8000"
- name: REPLICA_COUNT
  description: Number of replicas to run
  value: "1"
  required: true
labels:
  app: "${{NAME}}"
  template: webconsole-integration
message: "The following service(s) have been created in your project: ${{NAME}}, ${{APPLICATION_DOMAIN}}"